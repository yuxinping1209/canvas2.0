<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>canvas2.0</title>
	<link rel="stylesheet" href="./style.css">
    <script src="//at.alicdn.com/t/font_1544995_j62jlxb1co.js"></script>
</head>
<body>
<canvas id='a'></canvas>
<div id="actions" class="actions" aria-hidden="true">
<svg id="pen" class="icon">
    <use xlink:href="#icon-pen" aria-hidden="true"></use>
</svg>
<svg id="eraser" class="icon">
    <use xlink:href="#icon-eraser"></use>
</svg>
<svg id="clear" class="icon">
    <use xlink:href="#icon-clear" aria-hidden="true"></use>
</svg>
</div>
<div class="colors">
    <ol>
        <li id="red" class="red"></li>
        <li id="green" class="green"></li>
        <li id="blue" class="blue"></li>
    </ol>
</div>
<script>
	var canvas = document.getElementById('a')
	var context = canvas.getContext('2d')
	var using = false
    var lastPoint = {x:undefined,y:undefined}
    resize()
    window.onresize = function(){
        resize()  
    }
    function resize(){
        var pageWidth = document.documentElement.clientWidth
        var pageHeight =document.documentElement.clientHeight
        canvas.width = pageWidth
        canvas.height = pageHeight
    }

    function drawCircle(x,y,radius){
    	context.beginPath()
    	context.arc(x,y,radius,0,Math.PI*2)
    	context.fill()
    }
    function drawLine(x1,y1,x2,y2){
    	context.beginPath()
    	context.lineWidth = 4
    	context.moveTo(x1,y1)
    	context.lineTo(x2,y2)
    	context.stroke()
    	context.closePath()
    }
    //特性检测
    if(document.body.ontouchstart!==undefined){//触屏设备
    canvas.ontouchstart =function(aaa){
        
        var x = aaa.touches[0].clientX
        var y = aaa.touches[0].clientY
        if(eraserEnabled){
            using = true
            context.clearRect(x,y,10,10)

        }else{
            using = true
            lastPoint = {x:x,y:y}
            drawCircle(x,y,2)
        }
      
    }
    canvas.ontouchmove =function(aaa){
        var x = aaa.touches[0].clientX
        var y = aaa.touches[0].clientY
        if (eraserEnabled) {
            if (using) {
               context.clearRect(x,y,10,10) 
            }
        
        }else{
            if(using){
        var newPoint={x:x,y:y}
        drawCircle(x,y,2)
        drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
        lastPoint = newPoint
        
        }       

        }
    }
    canvas.ontouchend =function(){
        using=false
    }
}
    
    else{canvas.onmousedown = function(aaa){

    	var x = aaa.clientX
    	var y = aaa.clientY
        if(eraserEnabled){
            using = true
            context.clearRect(x,y,10,10)

        }else{
    	    using = true
            lastPoint = {x:x,y:y}
    	    drawCircle(x,y,2)
        }
    }

    canvas.onmousemove = function(aaa){
        var x = aaa.clientX
        var y = aaa.clientY

    	if (eraserEnabled) {
            if (using) {
               context.clearRect(x,y,10,10) 
            }
        
        }else{
            if(using){
        var newPoint={x:x,y:y}
        drawCircle(x,y,2)
        drawLine(lastPoint.x,lastPoint.y,newPoint.x,newPoint.y)
        lastPoint = newPoint
        
        }       

        }
        
    }
    canvas.onmouseup = function(aaa){
    	using = false
    }
    }
    var eraserEnabled = false 
    pen.onclick = function(){
        eraserEnabled = false
        pen.classList.add('active')
        eraser.classList.remove('active')

    } 

    eraser.onclick = function(){ 
        eraserEnabled = true 
        eraser.classList.add('active')
        pen.classList.remove('active')
    }
    red.onclick = function(){
        context.fillStyle='red'
        context.strokeStyle='red'
    }
    green.onclick = function(){
        context.fillStyle='green'
        context.strokeStyle='green'
    }
    blue.onclick = function(){
        context.fillStyle='blue'
        context.strokeStyle='blue'

    }
    clear.onclick = function(){
        context.clearRect(0,0,canvas.width,canvas.height)
    }
    
</script>	

</body>
</html>